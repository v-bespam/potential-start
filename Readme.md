# Документация к проекту

Проект создания начальной инфраструктуры небольшой компании состоит из нескольких скриптов:

1. initial-setup.sh - первоначальная настройка VPS сервера
2. ca-setup.sh - настройка удостоверяющего центра

Что нужно cделать:

- развернуть удостоверяющий центр для выдачи сертификатов (Public Key Infrastructure);
- создать и настроить VPN-сервер;
- настроить мониторинг;
- сделать резервное копирование;
- подготовить документацию;
- запланировать развитие инфраструктуры.

## Скрипт начальной настройки VPS сервера

Скрипт initial-setup.sh наценлен на использование с ОС Ubuntu и брандмауэром UFW. В самом начале скрипт проверяет, что запущен с правами суперпользователя и определяет дистрибутив. Затем предлогается ввести новое имя хоста, чтобы задать осмысленное имя серверу, а не случайно сгенерированное. Поскольку после создания VPS сервера предлагается использовать пользователя Root для подключаения по ssh, а это не безопасно, скрипт создает нового пользователя с правами администратора (пользователь будет добавлен в группу sudo). Необходимо лишь указать имя пользователя и пароль.

В файл authorized_keys нового пользователя копируются публичные ключи пользователя Root, для обеспечения возможности подключения по ssh, поэтому лучше сразу в момент создания VPS сервера добавить свои ключи. Так, они будут доступны и новому пользователю. Подключение по ssh пользователю Root будет запрещено путем редактировани файла конфигурации sshd_config.

Поледним этапом будет включение брадмауэра UFW. Выполняется обновление списка доступных в репозиториях пакетов, установка ufw, если он еще не установлен, разрешение работы службы OpenSSH и включение UFW. Служба sshd перезапускается в самом конце работы скрипта, это необходимо для применения запрета на подключение по ssh пользователю Root.

Теперь можно закрыть текущее подключение и заново подключиться по ssh используя имя ранее созданного пользователя.

## Скрипт настройки удостоверяющего центра

Первоначально скрипт проверяет что запущен от имени обычного пользователя, это сделано для того чтобы настройка Easy-RSA и создание конфигурационных файлов для него происходила в директории обычного пользователя. Административные права нужны для установки Easy-RSA.

Затем создается папка ~/easy-rsa в домашней директории, обновляется списко пакетов, устанавливается сам Easy-RSA и создается символическая ссылка /usr/share/easy-rsa/* в ранее созданный каталог, устанавливаются необходимые права на чтение. Запускается процесс инициализации PKI.

После этого скрипт запрашивает переменные, необходимые для развертывания удостоверяющего центра и запускает сам скрипт настройки CA.
